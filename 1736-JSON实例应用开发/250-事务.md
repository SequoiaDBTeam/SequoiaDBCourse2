---
show: step
version: 1.0

---

## 课程介绍

本课程将介绍在 Java 开发环境下如何在 SequoiaDB 数据库 JSON 实例中进行事务的操作。

#### JSON 开发简介

SequoiaDB 巨杉数据库为应用提供通过 SDK 驱动进行数据库操作和集群操作的接口。

#### 实验流程简述

- 用户通过 IDEA 编辑器编写 Java 源码
- 实验相关核心代码，可从文档中的代码示例粘贴到项目指定文件的 TODO 标记处
- 通过编译、运行 Java 代码，操作 SequoiaDB 数据库 JSON 实例

![](https://doc.shiyanlou.com/courses/1736/1207281/7b1731fc121e3b460dcd9841eb0218a6-0)

#### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎为 3.4 版本。IDEA 编辑器为 16.0 版本。JDK 为 1.8 版本。

## 打开项目

#### 打开 IDEA

打开 IDEA 代码开发工具。

<img src="https://doc.shiyanlou.com/courses/1736/1207281/06650396616c742995bb63fcf933fac5-0"  />

#### 打开项目

打开指定项目，在该项目中完成所有实验步骤。

![](https://doc.shiyanlou.com/courses/1736/1207281/9f17386c8098e8f4e46634f208fcd36b-0)

#### 打开 Package

打开指定的 Package，在该 Package 中完成后续课程。

![](https://doc.shiyanlou.com/courses/1736/1207281/c04fa6af595898e674fdb3a22aa647ff-0)

## 为插入操作添加事务

#### 概述

我们可以将多次的插入添加在同一个事务中，保证事务的原子性。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/17b05937729cd6b140e07c303fd88e31-0)

复制以下代码样例。

```java
db.beginTransaction();
// 向集合内插入2条数据,数据为Json格式
cl.insert("{ \"empno\": 10007, \"ename\": \"Trancer\", \"age\": " +
          "11}}");
cl.insert("{ \"empno\": 10008, \"ename\": \"Actioner\", \"age\": " +
          "12}}");
// 事务回滚
db.rollback();
```

将代码样例粘贴到第 20 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/4ed59ee0d0a7c77b5dcd95ff8b54e393-0)

右键点击 TransactionMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/09c153c8584eb35556b4235f1c567984-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/adfc20f28096fc1706412df3e71feeda-0) 

右键点击 TransactionMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/078e26a6715e7e51445235c5e99f6a44-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/901dc2026a24c5c09b18969d702778a0-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/b5033d12277482c838ff2f0d372b7769-0)

通过输出信息，可以看到事务回滚后，数据并未插入成功。

## 同一个事务内多个集合的操作

#### 概述

在同一个事务内，可以涉及到多个集合的操作。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/8bad6a603e622b890dd19c291bb79ade-0)

复制以下代码样例。

```java
// 开启事务
db.beginTransaction();
// 新建一个部门
departmentCl.insert("{ \"deptno\": 10008, \"deptname\": " +
                    "\"service\", \"note\": \"service department\"}}");
// 新建一条员工信息，并关联到该部门
employeeCl.insert("{ \"empno\": 10001, \"deptno\": 10008, " +
                  "\"ename\": \"Trancer\", \"age\": 11}}");
// 事务回滚
db.rollback();
```

将代码样例粘贴到第 25 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/4be2149f4a95646dada9d76600b34582-0)

右键点击 TransactionMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/09c153c8584eb35556b4235f1c567984-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/545dbef1a97f24f86643ca4618c24116-0) 

右键点击 TransactionMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/078e26a6715e7e51445235c5e99f6a44-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/901dc2026a24c5c09b18969d702778a0-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/75a5f61fa7150d8b2195b31edc6628e6-0)

通过输出信息，可以看到事务回滚后，多个集合内的操作并未生效，数据未插入成功。

## 总结

本课程介绍了在 Java 开发环境下如何在 SequoiaDB 数据库 JSON 实例中进行事务的操作。
