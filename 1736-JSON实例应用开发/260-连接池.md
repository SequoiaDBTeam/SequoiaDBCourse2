---
show: step
version: 1.0

---

## 课程介绍

本课程将介绍在 Java 开发环境下如何为 SequoiaDB 数据库 JSON 实例创建连接池。

#### JSON 开发简介

SequoiaDB 巨杉数据库为应用提供通过 SDK 驱动进行数据库操作和集群操作的接口。

#### 实验流程简述

- 用户通过 IDEA 编辑器编写 Java 源码
- 实验相关核心代码，可从文档中的代码示例粘贴到项目指定文件的 TODO 标记处
- 通过编译、运行 Java 代码，操作 SequoiaDB 数据库 JSON 实例

![](https://doc.shiyanlou.com/courses/1736/1207281/7b1731fc121e3b460dcd9841eb0218a6-0)

#### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎为 3.4 版本。IDEA 编辑器为 2019.3.4 版本。JDK 为 1.8 版本。

## 打开项目

#### 打开 IDEA

打开 IDEA 代码开发工具。

![](https://doc.shiyanlou.com/courses/1736/1207281/06650396616c742995bb63fcf933fac5-0)

#### 打开项目

打开指定项目，在该项目中完成所有实验步骤。

![](https://doc.shiyanlou.com/courses/1736/1207281/9f17386c8098e8f4e46634f208fcd36b-0)

#### 打开 Package

打开指定的 Package，在该 Package 中完成后续课程。

![](https://doc.shiyanlou.com/courses/1736/1207281/d960ca84f22a06f3ceaf4bb4f354a92e-0)

## 创建连接池

#### 概述

连接池需要配置各项参数。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/45a2db4bae85e8977debf4fa5c6c3737-0)

复制以下代码样例。

```java
ArrayList<String> addrs = new ArrayList<>();
ConfigOptions nwOpt = new ConfigOptions();
DatasourceOptions dsOpt = new DatasourceOptions();

// 提供coord节点地址,可添加多个
addrs.add("sdbserver1" + ":" + 11810);

// 设置网络参数
nwOpt.setConnectTimeout(500); // 建连超时时间为500ms。
nwOpt.setMaxAutoConnectRetryTime(0); // 建连失败后重试时间为0ms。

// 设置连接池参数
dsOpt.setMaxCount(500); // 连接池最多能提供500个连接。
dsOpt.setDeltaIncCount(20); // 每次增加20个连接。
dsOpt.setMaxIdleCount(20); // 连接池空闲时，保留20个连接。
dsOpt.setKeepAliveTimeout(0); // 池中空闲连接存活时间。单位:毫秒。
// 0表示不关心连接隔多长时间没有收发消息。
dsOpt.setCheckInterval(60 * 1000); // 每隔60秒将连接池中多于
// MaxIdleCount限定的空闲连接关闭，
// 并将存活时间过长（连接已停止收发
// 超过keepAliveTimeout时间）的连接关闭。
// 向catalog同步coord地址的周期。单位:毫秒。
dsOpt.setSyncCoordInterval(0);
// 0表示不同步。
// 连接出池时，是否检测连接的可用性，默认不检测。
dsOpt.setValidateConnection(false);
// 默认使用coord地址负载均衡的策略获取连接。
dsOpt.setConnectStrategy(ConnectStrategy.BALANCE);

// 建立连接池
ds = new SequoiadbDatasource(addrs, "sdbadmin", "sdbadmin",
                             nwOpt, dsOpt);
```

将代码样例粘贴到第 53 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/e3afd4f19de2e53e1a8eb2fd874cf527-0)

右键点击 DatasourceMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/fb4ed0c0cca751b72ab62f896cd012d8-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/805bf0f63297f518fc93408efe62fd2d-0) 

右键点击 DatasourceMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/cd64be8425c7d5f6e4b50ddb5574986a-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/394dfce14dddbf4f38ce173884c56d60-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/7d0a0f2fb56a94caa5fb60f5282d4856-0)

通过输出信息，可以看到通过连接池拿到链接后，可以成功的在数据库内创建数据，查询数据。

## 总结

本课程将介绍在 Java 开发环境下如何为 SequoiaDB 数据库 JSON 实例创建连接池。
