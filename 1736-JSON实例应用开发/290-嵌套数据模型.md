---
show: step
version: 1.0

---

## 课程介绍

本课程将介绍在 Java 开发环境下如何在 SequoiaDB 数据库 JSON 实例中进行一次完整的设计实例。

#### JSON 开发简介

SequoiaDB 巨杉数据库为应用提供通过 SDK 驱动进行数据库操作和集群操作的接口。

#### 实验流程简述

- 用户通过 IDEA 编辑器编写 Java 源码
- 实验相关核心代码，可从文档中的代码示例粘贴到项目指定文件的 TODO 标记处
- 通过编译、运行 Java 代码，操作 SequoiaDB 数据库 JSON 实例

![](https://doc.shiyanlou.com/courses/1736/1207281/7b1731fc121e3b460dcd9841eb0218a6-0)

#### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎为 3.4 版本。IDEA 编辑器为 16.0 版本。JDK 为 1.8 版本。

## 打开项目

#### 打开 IDEA

打开 IDEA 代码开发工具。

![](https://doc.shiyanlou.com/courses/1736/1207281/06650396616c742995bb63fcf933fac5-0)

#### 打开项目

打开指定项目，在该项目中完成所有实验步骤。

![](https://doc.shiyanlou.com/courses/1736/1207281/9f17386c8098e8f4e46634f208fcd36b-0)

#### 打开 Package

打开指定的 Package，在该 Package 中完成后续课程。

![](https://doc.shiyanlou.com/courses/1736/1207281/fe6a1ec2f1298f67b6eda21bcebf8bad-0)

## 设计实例

#### 概述

应用实例：

1. 设计一张学生表，内嵌学生的选课信息
2. 插入记录
3. 修改记录

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/612970f7df1ac874407645574e5ff358-0)

复制以下代码样例。

```java
// 创建集合空间
CollectionSpace cs = db.createCollectionSpace("school");
// 创建集合
DBCollection cl = cs.createCollection("student");
// 设计索引
BasicBSONObject column = new BasicBSONObject();
// 索引包含的字段
// 学生号
column.put("id", 1);
// 班级号
column.put("class", 1);
// 创建联合索引
cl.createIndex("idx_oid", column, true, false);
// 添加一条人员记录
BasicBSONObject jake = new BasicBSONObject();
jake.put("id", 1001);
jake.put("class", 301);
jake.put("name", "Jake");
// Jake的选课情况
BasicBSONList course = new BasicBSONList();
// Jake的选课包含music
BasicBSONObject music = new BasicBSONObject();
// music的课程id
music.put("courseId", 131);
// music的课程名称
music.put("courseName", "music");
// 将music添加到课程中去
course.add(music);
// 将课程添加到Jake的人员信息中去
jake.put("course", course);
cl.insert(jake);

DBCursor query = cl.query();
System.out.println("插入的数据为：");
JsonUtil.formatPrint(query);

// 修改Jake的选课信息，将music，替换为math
// 设置匹配规则，$et代表等于值
BSONObject matcher = new BasicBSONObject();
BSONObject et = new BasicBSONObject();
et.put("$et", "Jake");
matcher.put("name", et);
// 设置修改后的值
BasicBSONList courseList = new BasicBSONList();
BasicBSONObject math = new BasicBSONObject();
math.put("courseId", 145);
math.put("courseName", "math");
courseList.add(math);
BSONObject courseNew = new BasicBSONObject();
courseNew.put("course", courseList);
BSONObject modifier = new BasicBSONObject();
modifier.put("$set", courseNew);
// 更新数据
cl.update(matcher, modifier, null);
DBCursor updated = cl.query();
System.out.println("修改后的数据为：");
JsonUtil.formatPrint(updated);
```

将代码样例粘贴到第 27 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/15b1944d0e88da4a3ff3d0782f3022d1-0)

右键点击 InstanceMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/f8a33bf537e10a3d87f256c435cf196e-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/219c12dadb2b4bd459867a5d1661c3d0-0) 

右键点击 InstanceMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/a3ea796cf145dcf1b03a9073caea205b-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/aa6eaf0fea31af7fc0deeb85d3f8a8c4-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/d1b55284070162121e2513833732d7fe-0)

通过输出信息，可以看到成功修改了学生的的选课内容。

## 总结

本课程介绍了 Java 开发环境下如何在 SequoiaDB 数据库 JSON 实例中进行一次完整的设计实例。
