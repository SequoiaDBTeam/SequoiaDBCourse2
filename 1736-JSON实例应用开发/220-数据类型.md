---
show: step
version: 1.0


---

## 课程介绍

本课程将介绍在 Java 开发环境下如何使用 SequoiaDB 数据库 JSON 实例的各种数据类型。

#### JSON 开发简介

SequoiaDB 巨杉数据库为应用提供通过 SDK 驱动进行数据库操作和集群操作的接口。

#### 实验流程简述

- 用户通过 IDEA 编辑器编写 Java 源码
- 实验相关核心代码，可从文档中的代码示例粘贴到项目指定文件的 TODO 标记处
- 通过编译、运行 Java 代码，操作 SequoiaDB 数据库 JSON 实例

![](https://doc.shiyanlou.com/courses/1736/1207281/7b1731fc121e3b460dcd9841eb0218a6-0)

#### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎为 3.4 版本。IDEA 编辑器为 16.0 版本。JDK 为 1.8 版本。

## 打开项目

#### 打开 IDEA

打开 IDEA 代码开发工具。

![](https://doc.shiyanlou.com/courses/1736/1207281/06650396616c742995bb63fcf933fac5-0)

#### 打开项目

打开指定项目，在该项目中完成所有实验步骤。

![](https://doc.shiyanlou.com/courses/1736/1207281/9f17386c8098e8f4e46634f208fcd36b-0)

#### 打开 Package

打开指定的 Package，在该 Package 中完成后续课程。

![](https://doc.shiyanlou.com/courses/1736/1207281/fe6a1ec2f1298f67b6eda21bcebf8bad-0)

## JSON 对象嵌套的使用

#### 概述

在键值对集合结构中，每一个数据元素拥有一个键（名称）与一个值。值可以包含数字，字符串等常用结构，或嵌套 JSON 对象和数组。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/cedf09ce069be00717a953b85334bf0b-0)

复制以下代码样例。

```java
// 创建一条人员记录
BasicBSONObject record = new BasicBSONObject();
// 为人员添加属性
record.put("ename", "Georgi");
record.put("age", 22);
// 为人员添加嵌套的对象属性 position
// 职位对象包含信息:{职位名:工程师, 级别：P3, 薪水：9000}
BasicBSONObject position = new BasicBSONObject();
position.put("position_name", "engineer");
position.put("level", "P3");
position.put("pay", 9000);
// 将position对象内嵌到这条人员记录的属性中去
record.put("position", position);
// 向employee集合中插入这条记录
cl.insert(record);
```

将代码样例粘贴到第 17 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/c28824bc7ddc8988494e42d5aee1930b-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/cb1c5ca91a913d963d81756f98a65b83-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/8074c0d2f21e21af01a93f5854562433-0)

通过输出信息，可以看到我们插入的这条嵌套对象记录。

## 数组类型的使用

#### 概述

在数组中的每一个元素不包含元素名，其值可以为数字，字符串等常用结构，或者嵌套 JSON 对象和数组。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/34dcfdb8146b29708935c91952ffd069-0)

复制以下代码样例。

```java
BasicBSONObject record = new BasicBSONObject();
// 为人员添加属性
record.put("ename", "Georgi");
record.put("age", 22);
//为人员添加数组类型属性 favorite
//喜好:[basketball,football]
BasicBSONList favorite = new BasicBSONList();
favorite.add("football");
favorite.add("basketball");
//将favorite数组内嵌到这条人员记录的属性中去
record.put("favorite", favorite);
//向employee集合中插入这条record
cl.insert(record);
```

将代码样例粘贴到第 17 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/c088a849f519ea5df8a7e5c0cf3e751c-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/ca836e792b6d4e9198a537580c8a76a9-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/17422c79f1642fa0e0e23e7cf9c7eb55-0)

通过输出信息，可以看到插入的数组类型对象。

## 对象ID的使用

#### 概述

Java BSON 使用 org.bson.types.ObjectId 来生成每条记录的“\_id”字段内容。目前，Java ObjectId 的 12字节内容由三部分组成：4字节精确到秒的时间戳，4字节系统（物理机）标示，4字节由随机数起始的序列号。默认情况下，数据库为每条记录生成一个字段名为“_id”的唯一对象 ID。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/e789b6b045787d372e842ab8f869498f-0)

复制以下代码样例。

```java
//将_id作为查询条件传入，进行查询
ObjectId id = new ObjectId(idStr);
queryOne = cl.query(new BasicBSONObject("_id", id), null,
                    null, null);
```

将代码样例粘贴到第 32 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/41bbca41e6929784230017bf24951420-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/dc9f0dfbc2ac92ab5bbc9f36b62ad9b9-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](C:\Users\SequoiaDB\AppData\Roaming\Typora\typora-user-images\1586841648666.png)

通过输出信息，可以看到通过 id 成功获取了指定数据信息。

## 日期的使用

#### 概述

Java BSON 使用 java.util.Date 来构造日期类型。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/a3937ba198cc06df3bc20bce1334afdc-0)

复制以下代码样例。

```java
BSONObject record = new BasicBSONObject();
// 为人员添加属性
record.put("ename", "Georgi");
// 为人员添加入职日期属性，对象类型为Date
String str = "2020-3-25";
SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
java.util.Date date = format.parse(str);
record.put("date", date);
// 向employee集合中插入这条record
cl.insert(record);
```

将代码样例粘贴到第 20 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/6759c4f8afbe6b6b66a268716b1ff75e-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/b1de614a479ac07a3fc455c122e66d00-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/933f6dd1b24a31d4406ed9d77f9daa43-0)

通过输出信息，可以看到成功插入了日期类型的数据。

## 时间戳的使用

#### 概述

Java BSON 使用 org.bson.types.BSONTimestamp 来构造时间戳类型。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/3c8879ceac13c1ed949c7a38ea002ba8-0)

复制以下代码样例。

```java
// 创建一条人员记录
BasicBSONObject record = new BasicBSONObject();
// 为人员添加属性
record.put("ename", "Georgi");
String mydate = "2020-01-01 12:30:30.124232";
String dateStr = mydate.substring(0, mydate.lastIndexOf('.'));
String incStr = mydate.substring(mydate.lastIndexOf('.') + 1);
// 创建一个日期时间字符串格式化对象
SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
// 将日期时间字符串转换成Date对象
Date date = format.parse(dateStr);
// 将日期时间转换成时间戳（精确到秒）
int seconds = (int) (date.getTime() / 1000);
// 将小数点后面的部分转换成时间戳
int inc = Integer.parseInt(incStr);
// 创建时间戳对象
BSONTimestamp ts = new BSONTimestamp(seconds, inc);
record.put("timestamp", ts);
cl.insert(record);
```

将代码样例粘贴到第 21 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/82a8392e8276fbf4120a16e9ec2bf2d4-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/37e930d1ad25fd7f3faeb3d7614ac0fd-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/13f2a34bfd115f4620350bf4c96b2849-0)

通过输出信息，可以看到成功创建了时间戳类型的数据。

## 二进制数据的使用

#### 概述

Java BSON 使用 org.bson.types.Binary 来构造二进制类型。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/783e60062fcad7171b492f537b6a9c69-0)

复制以下代码样例。

```java
// 创建一条人员记录
BasicBSONObject record = new BasicBSONObject();
// 为人员添加属性
record.put("ename", "Georgi");
// 准备一条用于转换成二进制数据的字符串
String str = "This is the binary data";
// 获取对象的二进制流
byte[] arr = str.getBytes();
// 创建一个二进制对象
org.bson.types.Binary binary = new org.bson.types.Binary(arr);
record.put("binary", binary);
cl.insert(record);
```

将代码样例粘贴到第 16 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/d78d40ae5a7b96019d1b364f36d40ce5-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/9633e702f79724e5a1d0ad21d18eaf8b-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/540f9a8509743acbaff49e710a21d1e4-0)

通过输出信息，可以看到成功插入了二进制数据。

## 正则表达式的使用

#### 概述

Java BSON 使用 java.util.regex.Pattern 来构造正则表达式数据类型。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/4f036d1773ca074aced6489f8142a96d-0)

复制以下代码样例。

```java
// matcher中设置正则表达式
BSONObject matcher = new BasicBSONObject();
// 设置正则表达式规则为：匹配以Anne开头的字符串
Pattern obj = Pattern.compile("^Anne", Pattern.CASE_INSENSITIVE);
matcher.put("ename", obj);
// modifier中设置要修改的值，将age修改为55
BSONObject modifier = new BasicBSONObject("$set", new BasicBSONObject("age", 55));
// 执行更新造作
cl.update(matcher, modifier, null);
```

将代码样例粘贴到第 24 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/4e49b20e3ab97108247c908f1c30e6e4-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/94ac89027a48df6c271c5456c39ba855-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/0cf14ad290e799e1a9a39e9887f5cc79-0)

通过输出信息，可以看到通过正则表达式，成功匹配到了指定数据，然后通过更新接口，修改了 age 字段。

## 高精度数的使用

#### 概述

Java BSON 使用 org.bson.types.BSONDecimal 来构造高精度数据类型。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/60a0b0a12324da64763a6b35a4475328-0)

复制以下代码样例。

```java
// 创建一条人员记录
BasicBSONObject record = new BasicBSONObject();
// Java BSON 构造不带精度要求的Decimal类型
// {a:{"$decimal":"12345.067891234567890123456789"}}
String str = "12345.067891234567890123456789";
BSONDecimal decimal = new BSONDecimal(str);
record.put("未固定长度数据", decimal);

// Java BSON 构造一个最多有100位有效数字，其中小数部分最多有30位的Decimal类型
// {b:{"$decimal":"12345.067891234567890123456789", "$precision":[100, 30]}}
BSONDecimal decimal2 = new BSONDecimal(str, 100, 30);
record.put("固定长度数据", decimal2);
cl.insert(record);
```

将代码样例粘贴到第 17 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/7427b2a463905d001ace81cf4154ae54-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/5f86e9da49c81f0eda17068e3d069992-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/19dfe0172f2dc337abb6667dffd79202-0)

通过输出信息，可以看到成功插入了不同精度的高精度数。

## LOB 对象的使用

#### 概述

Java BSON 使用 com.sequoiadb.base.DBLob 来构造 LOB 大对象数据类型。

#### 操作步骤

打开指定的 Java 源文件。

![](https://doc.shiyanlou.com/courses/1736/1207281/b38e01273553adf6241af4c6b198f360-0)

复制以下代码样例。

```java
BSONObject record = new BasicBSONObject();
// 创建含有文字内容的文件流
String word = "你好！这是 Text 文件的具体内容。";
// 创建Lob
DBLob lob = cl.createLob();
// 给 lob 添加文件流
lob.write(word.getBytes());
// 获取创建 lob 成功后的唯一标识 ID
ObjectId id = lob.getID();
// 打印 ID
String s = id.toString();
System.out.println("创建 lob 对象后生成的 ID 为：" + s);
// 关闭文件流
lob.close();
// 获取已经插入的 lob 对象
DBLob lobCopy = cl.openLob(id);
byte[] bytes = new byte[64];
// 将 lob 对象的文件流读取到内存中
lobCopy.read(bytes);
String get = new String(bytes);
System.out.println("获取到的 lob 对象文件流内容为：" + get);
lob.close();
```

将代码样例粘贴到第 17 行的 TODO ~ TODO END 位置区间内。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/2ef47ba614f59761bdf4ce8d7407d370-0)

右键点击 DataMainTest 类，创建/编辑主类运行环境。

![](https://doc.shiyanlou.com/courses/1736/1207281/e0f11e1862f56c22f1b6834aeb66281d-0)

配置 Configuration 页中的 Program arguments 选项，写入指定的参数，点击”OK“。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/d9da9745482c2dc5ca4e6256f923d7c5-0) 

右键点击 DataMainTest 类，运行主程序。

![](https://doc.shiyanlou.com/courses/1736/1207281/288baf6c0015a24ee234fcb43fd0f741-0)

在 IDEA 输出窗口查看运行效果。

![// TODO 贴图](https://doc.shiyanlou.com/courses/1736/1207281/92049db96c48c66a5bb433805cb729f8-0)

双击放大控制台输出窗口，查看详细输出信息。

![](https://doc.shiyanlou.com/courses/1736/1207281/8ef600563cc0a954e5b5e16263a207ba-0)

通过输出信息，可以看到成功成功创建了 LOB 对象，并获取到了 LOB 对象的流内容。

## 总结

本课程介绍了在 Java 开发环境下如何使用 SequoiaDB 数据库 JSON 实例的各种数据类型。
