---
show: step
version: 1.0 
---

## 课程介绍

本课程将带领您在已经部署 SequoiaDB 巨杉数据库引擎及创建了 SequoiaSQL-MySQL 实例的环境中，熟悉 MySQL 的视图和触发器

#### 请点击右侧选择使用的实验环境

#### 部署架构：

本课程中 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，其中包括：1个 SequoiaSQL-MySQL 数据库实例节点、1个引擎协调节点，1个编目节点与3个数据节点。

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/8d88e6faed223a26fcdc66fa2ef8d3c5)

详细了解 SequoiaDB 巨杉数据库系统架构：

- [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

#### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎以及 SequoiaSQL-MySQL 实例均为 3.4 版本。

#### 概述

**视图**

视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。

**触发器**

触发器是 MySQL 响应以下任意语句而自动执行的一条 MySQL 语句（或位于 BEGIN 和 END 语句之间的一组语句） ：DELETE、INSERT、UPDATE。

## 打开项目

#### 打开idea

打开 idea 代码开发工具

![1735-110-1.png](https://doc.shiyanlou.com/courses/1735/1207281/6f87a8c93937c3c51f6d4839559de710-0)

#### 打开SSQL-MySQL项目

打开 SSQL-MySQL 项目，在该课程中完成后续试验

![1735-110-13.png](https://doc.shiyanlou.com/courses/1735/1207281/40a9e7b6fbd5c3853dc09f69d0a06c86-0)

#### 打开lesson8_viewAndTrigger包

打开 lesson8_viewAndTrigger packge，在该 packge 中完成后续课程

![1735-180-1.png](https://doc.shiyanlou.com/courses/1735/1207281/be12989d771e7c9e6ec98542e8f2050b-0)

## 创建、删除、查看视图

视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。

创建视图

> CREATE [OR REPLACE] VIEW 视图名(列1，列2...)
>
> AS SELECT (列1，列2...)
>
> FROM ...;
>
> [WITH [CASCADED|LOCAL] CHECK OPTION]

删除视图

> DROP VIEW viewname;

查看视图

> DESC viewname;

#### 创建视图

基于数据库表 employee，创建视图 employee_view，使用 create view 命令

1）打开 ViewTest.java
2）修改 createView 方法的 TODO code 1中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//执行 sql
stmt.executeUpdate("CREATE OR REPLACE VIEW employee_view AS SELECT * FROM employee;");
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 createView
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

#### 查看视图数据

1）打开 ViewTest.java
2）修改 queryView 方法的 TODO code 2中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//编写 sql
String sql = "SELECT * FROM employee_view";
//执行 sql
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 queryView
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

​			10001	Georgi	48	
​			10003	Parto	33	
​			10005	Kyoichi	23	
​			10002	Bezalel	21	
​			10004	Chirs	40	
​			10006	Anneke	19	

#### 删除视图

1）打开 ViewTest.java
2）修改 queryView 方法的 TODO code 3中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//执行
stmt.executeUpdate("DROP VIEW employee_view;");
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 dropView
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

## 更新、修改视图

#### 更新视图

更新修改视图里的记录，利用 update 命令

1）打开 ViewTest.java
2）修改 updateView 方法的 TODO code 4中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//执行 sql
stmt.executeUpdate("UPDATE employee_view SET age = 38 WHERE ENAME = 'Georgi';");
String sql = "SELECT * FROM employee_view where ename = 'Georgi'";
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 updateView
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

结果为：10001	Georgi	38	

#### 修改视图

使用 ALTER 语句修改视图，让视图只存储 employee 表的 ename 和 age 字段

1）打开 ViewTest.java
2）修改 alterView 方法的 TODO code 5中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//编写 sql 修改视图
String sql1 ="ALTER VIEW employee_view AS SELECT ename,age FROM employee;";
//执行 sql
stmt.executeUpdate(sql1);
//编写 sql 查询视图
String sql2 = "SELECT * FROM employee_view";
rs = stmt.executeQuery(sql2);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 alterView
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

​			10001	Georgi	38	
​			10003	Parto	33	
​			10005	Kyoichi	23	
​			10002	Bezalel	21	
​			10004	Chirs	40	
​			10006	Anneke	19	

## 查询所有视图

1）打开 ViewTest.java
2）修改 showView 方法的 TODO code 6中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//编写 sql 查看所有视图
String sql = "SHOW TABLE STATUS WHERE COMMENT='view';";
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 showView
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

结果为：employee_view	null	null	null	null	null	null	null	null	null	null	null	null	null	null	null	null	VIEW

## 创建insert触发器

insert 触发器在 insert 语句执行之前或之后执行。需要知道以下几点：

- 在 INSERT 触发器代码内，可引用一个名为 NEW 的虚拟表，访问被插入的行；
- 在 BEFORE INSERT 触发器中, NEW 中的值也可以被更新（允许更改被插入的值）；
- 对于 AUTO_INCREMENT 列，NEW 在 INSERT 执行之前包含0，在 INSERT 执行之后包含新的自动生成值。

创建一个insert触发器

1）打开 TriggerTest.java
2）修改 createInsertTrigger 方法的 TODO code 1中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//执行 sql 创建 insert 触发器
stmt.executeUpdate("CREATE TRIGGER newemployee AFTER INSERT ON employee FOR EACH ROW SELECT 'Employee added' INTO @result;");
//执行 sql 插入数据
stmt.executeUpdate("INSERT INTP employee VALUES(10007,'Bob',22);");
//编写 sql 检测触发器是否生效
String sql = "SELECT @result;";
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 createInsertTrigger
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

运行结果:Employee added	

## 创建update触发器

1）打开 TriggerTest.java
2）修改 createUpdateTrigger 方法的 TODO code 2中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//执行 sql 创建 update 触发器
stmt.executeUpdate("CREATE TRIGGER updateemployee BEFORE UPDATE ON employee FOR EACH ROW SELECT 'Employee updated' INTO @result;");
//执行 sql 更新数据
stmt.executeUpdate("update employee set ename = 'Chiruis' where empno = 10004;");
//编写 sql 检查触发器是否生效
String sql = "select @result;";
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 createUpdateTrigger
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

运行结果:Employee updated	

## 创建delete触发器

1）打开 TriggerTest.java
2）修改 createDeleteTrigger 方法的 TODO code 3中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//编写 sql 创建 delete 触发器
stmt.executeUpdate("CREATE TRIGGER deleteemployee BEFORE DELETE ON employee FOR EACH ROW SELECT 'Employee deleted' INTO @result;");
stmt.executeUpdate("DELETE FROM employee WHERE empno = 10002;");
String sql = "select @result;";
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 createDeleteTrigger
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果

运行结果:Employee deleted	

## 触发器查询、删除

#### 触发器查询

1）打开 TriggerTest.java
2）修改 showTrigger 方法的 TODO code 4中代码为

打开TriggerTest.java，修改第16行的showTrigger方法TODO

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//编写 sql
String sql = "show triggers;";
//执行 sql
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 showTrigger
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果



#### 触发器删除

1）打开 TriggerTest.java
2）修改 deleteTrigger 方法的 TODO code 5中代码为

```java
//创建一个 Statement 对象来将 SQL 语句发送到数据库
stmt = conn.createStatement();
//执行 sql 删除触发器
stmt.executeUpdate("DROP TRIGGER updateemployee;");
//编写 sql 查看触发器
String sql = "show triggers;";
rs = stmt.executeQuery(sql);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

3）修改参数，右键 ViewAndTriggerMainTest.java，选择 Edit 'ViewAndTrigger...main()'

![1735-180-2.png](https://doc.shiyanlou.com/courses/1735/1207281/b96e7e82654e43fc0c06df6211c93efc-0)

4）修改参数为 deleteTrigger
5）执行代码，右键 ViewAndTriggerMainTest.java，选择 Run 'ViewAndTrigger.main()'，运行代码

![1735-180-4.png](https://doc.shiyanlou.com/courses/1735/1207281/85a5b06640269cd3054ced44d35e8a27-0)

6）查看结果



