---
show: step
version: 1.0 
---
# 1.5数据操作

## 课程介绍

本课程将带领您在已经部署 SequoiaDB 巨杉数据库引擎及创建了 MySQL 实例的环境中，熟悉MySQL数据操作

#### 请点击右侧选择使用的实验环境

#### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎以及 SequoiaSQL-MySQL 实例均为 3.4 版本。

#### 概述

除了前一章学到的SELECT，还有其他3个经常使用的数据操作SQL需要学习。本章将为大家介绍MySQL的INSERT、DELETE、UPDATE等。

## 打开项目

#### 打开idea

打开idea代码开发工具

![1735-110-1.png](https://doc.shiyanlou.com/courses/1735/1207281/6f87a8c93937c3c51f6d4839559de710-0)

#### 打开SSQL-MySQL项目

打开SSQL-MySQL项目，在该课程中完成后续试验

![1735-110-13.png](https://doc.shiyanlou.com/courses/1735/1207281/40a9e7b6fbd5c3853dc09f69d0a06c86-0)

#### 打开lesson5_crud包

打开lesson5_crud packge，在该packge中完成后续课程。

![1735-150-1.png](https://doc.shiyanlou.com/courses/1735/1207281/468945a8bf8317b68d9ac5e44481b1c4-0)

## insert

#### 概述

insert是用来插入（或添加）行到数据库表的。

#### 初始化数据库环境

右键CRUDMainTest，选择Edit修改参数为init，再次右键CRUDMainTest选择Run，运行初始化数据库环境代码

![1735-150-2.png](https://doc.shiyanlou.com/courses/1735/1207281/74758faf7897fea90cf319f125bf5f89-0)

![1735-150-3.png](https://doc.shiyanlou.com/courses/1735/1207281/c0f232a62461501adabd9fd1325239d4-0)

![1735-150-4.png](https://doc.shiyanlou.com/courses/1735/1207281/886e4b6bd64a1117f924d7bdf6ebcd84-0)

创建打开UpdateTest.java,修改第8行TODO中的代码，创建employee表，并插入数据

```java
stmt = conn.createStatement();
String sql = "CREATE TABLE employee " +
    "(" +
    "empno INT AUTO_INCREMENT PRIMARY KEY, " +
    "ename VARCHAR(128), " +
    "age INT" +
    ")";
stmt.executeUpdate(sql); //执行创建employee
String sql2 = "INSERT INTO employee VALUES (10001, 'Georgi', 48),(10002, 'Bezalel', 21)" +
    ",(10003, 'Parto', 33),(10004, 'Chirs', 40)" +
    ",(10005, 'Kyoichi', 23), (10006, 'Anneke', 19);";
stmt.executeUpdate(sql2); //执行向employee插入数据操作
String sql3 = "select * from employee;";
rs = stmt.executeQuery(sql3);//查询employee，获得结果集
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest,选择Edit，修改参数为crud，再次右键CRUDMainTest，选择Run，执行代码

![1735-150-5.png](https://doc.shiyanlou.com/courses/1735/1207281/bdb25288d18622e3d7419cf0c2c588ed-0)

输出结果为：

​			10001	Georgi	48	
​			10003	Parto	33	
​			10005	Kyoichi	23	
​			10002	Bezalel	21	
​			10004	Chirs	40	
​			10006	Anneke	19	

## insert select、create table as select

#### insert select

INSERT SELECT 语句从一个表复制数据，然后把数据插入到一个已存在的表中。

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "CREATE TABLE employeeBak " +
    "(" +
    "empno INT AUTO_INCREMENT PRIMARY KEY, " +
    "ename VARCHAR(128), " +
    "age INT" +
    ")";
stmt.executeUpdate(sql);
String sql2 = "insert into employeeBak select * from employee";
stmt.executeUpdate(sql2);
String sql3 = "select * from employeeBak;";
rs = stmt.executeQuery(sql3);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest，选择Run，执行代码

输出结果为：

​			10001	Georgi	48	
​			10003	Parto	33	
​			10005	Kyoichi	23	
​			10002	Bezalel	21	
​			10004	Chirs	40	
​			10006	Anneke	19	

#### create table as select

创建oldEmployee表，并复制employee中age大于20的值

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "create table oldEmployee select * from employee where age > 20";
stmt.executeUpdate(sql);
String sql3 = "select * from oldEmployee;";
rs = stmt.executeQuery(sql3);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest，选择Run，执行代码

输出结果为：

​			10001	Georgi	48	
​			10003	Parto	33	
​			10005	Kyoichi	23	
​			10002	Bezalel	21	
​			10004	Chirs	40

## delete

删除表oldEmployee表中name等于Chirs的行

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "delete from oldEmployee where ename = 'Chirs'";
stmt.executeUpdate(sql);
String sql3 = "select * from oldEmployee;";
rs = stmt.executeQuery(sql3);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest，选择Run，执行代码

输出结果为：

​			10001	Georgi	48	
​			10003	Parto	33	
​			10005	Kyoichi	23	
​			10002	Bezalel	21	

## 全表删除（ delete、truncate、drop）

> delete命令删除的数据可以恢复
>
> truncate命令删除的数据是不可以恢复的
>
> drop命令删除的数据不可恢复，连表结构都删除
>
> ———————————————————————————————————————————
>
> 相同点
>
> truncate 和不带 where 子句的 delete, 以及 drop 都会删除表内的数据。
>
> 不同点:
>
> 1. truncate 和 delete 只删除数据不删除表的结构，drop 语句将删除表的结构被依赖的约束(constrain), 触发器(trigger), 索引(index); 依赖于该表的存储过程/函数将保留, 但是变为 invalid 状态。
>
> 2.delete 语句是 dml, 这个操作会放到 rollback segement 中, 事务提交之后才生效; 如果有相应的 trigger, 执行的时候将被触发。 truncate, drop 是 ddl, 操作立即生效, 原数据不放到 rollback segment 中, 不能回滚。 操作不触发 trigger。
>
> 3.delete 语句不影响表所占用的 extent, 高水线(high watermark)保持原位置不动。 显然 drop 语句将表所占用的空间全部释放 。 truncate 语句缺省情况下见空间释放到 minextents 个 extent, 除非使用 reuse storage; truncate会将高水线复位(回到最开始)。
>
> 4.速度：一般来说: drop > truncate > delete 。
>
> 5.安全性: 小心使用 drop 和 truncate, 尤其没有备份的时候。否则哭都来不及。

#### truncate

使用truncate清除表oldEmployee表内的数据，保存表结构

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "truncate table oldEmployee";
stmt.executeUpdate(sql);
String sql3 = "desc oldEmployee;";
rs = stmt.executeQuery(sql3);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest，选择Run，执行代码

输出结果为：

​			empno	int(11)	NO		0		
​			ename	varchar(128)	YES		null		
​			age	int(11)	YES		null

#### drop

使用drop删除表employeeBak

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "drop table employeeBak";
stmt.executeUpdate(sql);
```

右键CRUDMainTest，选择Run，执行代码

## update

将表employee中name为Parto的age修改为23

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "update employee set age = 23 where ename = 'Parto'";
stmt.executeUpdate(sql);
String sql3 = "select * from employee where ename ='Parto'";
rs = stmt.executeQuery(sql3);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest，选择Run，执行代码

输出结果为：

​			10003	Parto	23	

## replace

> mysql中replace函数是直接替换mysql数据库中某字段中的特定字符串，不再需要自己写函数去替换，用起来非常方便

使用replace将表employee中Kyoichi替换为Kyoic

创建打开UpdateTest.java,修改第8行的代码

```java
stmt = conn.createStatement();
String sql = "update employee set ename = replace(ename,'Kyoichi','Kyoic')";
stmt.executeUpdate(sql);
String sql3 = "select * from employee where ename ='Kyoic'";
rs = stmt.executeQuery(sql3);
while (rs.next()) {
    for (int i = 1; i <= rs.getMetaData().getColumnCount() ; i++) {
        System.out.print(rs.getString(i)+"\t");
    }
    System.out.println();
}
```

右键CRUDMainTest，选择Run，执行代码

输出结果为：

​			10005	Kyoic	23	



